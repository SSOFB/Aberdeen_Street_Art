!function(e){var t=function(){var t=this,s={timer:!1};this.fields={},this.maps={},this.markers={};this.registerField=function(t,o,a){if(!document.getElementById(o)){var i=document.getElementById(a);e(i).after(e('<div id="'+o+'"/>')),this.fields[t]={element:document.getElementById(o),target:i,watch:"target",method:"setupMap",setup:!1},s.timer||n()}},this.registerDisplay=function(e,t){this.fields[e]||(this.fields[e]={element:document.getElementById(t),watch:"element",method:"setupDisplay",setup:!1},s.timer||n())};var n=function(){var o=!1;e.each(t.fields,function(e,s){s.setup||(null===s[s.watch]||null===s[s.watch].offsetParent?o=!0:t[s.method](e))}),o?setTimeout(n,1e3):s.timer=!1};this.setupMap=function(o){this.setupDisplay(o),t.maps[o].addListener("click",function(o){var s=[o.latLng.lat(),o.latLng.lng()];e(t.fields[this.plg_fields_location_id].target).val(s.join(",")),t.markers[this.plg_fields_location_id].setPosition(o.latLng)}),Joomla.getOptions("plg_fields_location_"+o).searchbox&&t.setupSearch(o),t.fields[o].setup=!0},this.setupSearch=function(o){var s=e('<input id="'+t.fields[o].element.id+'_searchbox" class="xcontrols" type="text" placeholder="'+Joomla.JText._("PLG_FIELDS_LOCATION_SEARCHBOX_PLACEHOLDER")+'">');e(t.fields[o].target).after(s);var n=document.getElementById(t.fields[o].element.id+"_searchbox"),a=new google.maps.places.SearchBox(n);t.maps[o].controls[google.maps.ControlPosition.TOP_LEFT].push(n),t.maps[o].addListener("bounds_changed",function(){a.setBounds(t.maps[o].getBounds())}),a.addListener("places_changed",function(){var e=a.getPlaces();if(0!=e.length){new google.maps.LatLngBounds;e[0].geometry?(t.maps[o].setCenter(e[0].geometry.location),t.markers[o].setPosition(e[0].geometry.location)):console.log("place has no geometry")}})},this.setupDisplay=function(e){var s=Joomla.getOptions("plg_fields_location_"+e),n={zoom:parseInt(s.zoom),center:new google.maps.LatLng(s.center[0],s.center[1]),mapTypeId:google.maps.MapTypeId[s.mapTypeId]};t.maps[e]=new google.maps.Map(t.fields[e].element,n),t.maps[e].plg_fields_location_id=e,t.markers[e]=new google.maps.Marker({position:n.center,map:t.maps[e]}),t.fields[e].setup=!0,markerMyLocation=new google.maps.Marker;const a=document.createElement("div");a.textContent="Go to your current location",a.classList.add("custom-map-control-button"),a.classList.add("btn"),a.classList.add("btn-primary"),t.maps[e].controls[google.maps.ControlPosition.TOP_CENTER].push(a),a.addEventListener("click",()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(o=>{const s={lat:o.coords.latitude,lng:o.coords.longitude};t.maps[e].setCenter(s),markerMyLocation.setPosition(s),markerMyLocation.setMap(t.maps[e])},()=>{o(!0,markerMyLocation,t.maps[e].getCenter(),t.maps[e])}):o(!1,markerMyLocation,t.maps[e].getCenter(),t.maps[e])}),document.getElementById("jform_com_fields_location").addEventListener("change",o=>{var s=document.getElementById("jform_com_fields_location").value;console.log("latlon: "+s);let n=s.split(",");console.log("lat: "+n[0]),console.log("lon: "+n[1]);const a={lat:parseFloat(n[0]),lng:parseFloat(n[1])};t.maps[e].setCenter(a),markerMyLocation.setPosition(a),markerMyLocation.setMap(t.maps[e])})}};function o(e,t,o,s){t.setPosition(o),t.setContent(e?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation."),t.setMap(s)}e(document).ready(function(){window.plg_fields_location=new t})}(jQuery);